# Mobile Build Guide - PaceMatch with Capacitor

This guide will help you build and deploy PaceMatch as a native mobile app for iOS and Android using Capacitor.

## üì± What's Been Set Up

Your app has been configured with:
- ‚úÖ Capacitor core and platform plugins (iOS & Android)
- ‚úÖ Geolocation plugin for native GPS tracking
- ‚úÖ Camera plugin for photo capture
- ‚úÖ Platform detection utilities
- ‚úÖ Updated location tracking hook (works on web and native)

## üöÄ Quick Start

### Prerequisites

1. **For Android:**
   - Android Studio installed
   - Android SDK (API level 33+)
   - Java Development Kit (JDK 17+)

2. **For iOS (Mac only):**
   - Xcode 14+ installed
   - CocoaPods installed (`sudo gem install cocoapods`)
   - Apple Developer account (for device testing and App Store)

### Development Workflow

#### Step 1: Build Your Web App
```bash
cd pacematch-connect
npm run build
```

This creates the `dist/` folder with your production-ready web app.

#### Step 2: Sync with Native Platforms
```bash
# Sync both platforms
npx cap sync

# Or sync individually
npx cap sync android
npx cap sync ios
```

This copies your web app to native projects and updates native dependencies.

#### Step 3: Open in Native IDE

**For Android:**
```bash
npx cap open android
```
This opens Android Studio where you can:
- Run on emulator or connected device
- Build APK or AAB
- Debug native code

**For iOS:**
```bash
npx cap open ios
```
This opens Xcode where you can:
- Run on simulator or connected device
- Build for App Store
- Debug native code

## üîß Building for Production

### Android Build

#### Option 1: Build APK (for direct installation)
1. Open Android Studio: `npx cap open android`
2. Go to **Build > Generate Signed Bundle / APK**
3. Select **APK**
4. Choose your keystore (or create new one)
5. Select build variant: **release**
6. Build and install APK on device

#### Option 2: Build AAB (for Google Play Store)
1. Open Android Studio: `npx cap open android`
2. Go to **Build > Generate Signed Bundle / APK**
3. Select **Android App Bundle**
4. Choose your keystore
5. Select build variant: **release**
6. Upload AAB to Google Play Console

#### Using Command Line (Gradle)
```bash
cd android
./gradlew assembleRelease  # For APK
./gradlew bundleRelease    # For AAB
```

**Note:** APK will be in `android/app/build/outputs/apk/release/`
**Note:** AAB will be in `android/app/build/outputs/bundle/release/`

### iOS Build

#### For Testing (Ad Hoc Distribution)
1. Open Xcode: `npx cap open ios`
2. Select your development team in **Signing & Capabilities**
3. Connect your iOS device
4. Select your device from the device list
5. Click **Run** (‚ñ∂Ô∏è) or press `Cmd + R`

#### For App Store
1. Open Xcode: `npx cap open ios`
2. Select **Any iOS Device** as target
3. Go to **Product > Archive**
4. Once archived, click **Distribute App**
5. Choose **App Store Connect**
6. Follow the upload wizard

## üìù Important Configuration Files

### Android Permissions
Location permissions are already configured in:
- `android/app/src/main/AndroidManifest.xml` (auto-generated by Capacitor)

### iOS Permissions
Location permissions are configured in:
- `ios/App/App/Info.plist` (auto-generated by Capacitor)

You may need to add usage descriptions manually if they're missing:
```xml
<key>NSLocationWhenInUseUsageDescription</key>
<string>PaceMatch needs your location to show you nearby runners and track your workouts.</string>
<key>NSLocationAlwaysUsageDescription</key>
<string>PaceMatch needs your location to track workouts even when the app is in the background.</string>
```

## üîÑ Development Workflow

### Making Changes

1. **Edit your web code** (React/TypeScript files)
2. **Build the web app:**
   ```bash
   npm run build
   ```
3. **Sync to native:**
   ```bash
   npx cap sync
   ```
4. **Test in native IDE** (Android Studio or Xcode)

### Hot Reload (Development)

For faster development, you can use live reload:

1. **Start web dev server:**
   ```bash
   npm run dev
   ```

2. **Update capacitor.config.ts** to point to dev server:
   ```typescript
   server: {
     url: 'http://YOUR_LOCAL_IP:8080',
     cleartext: true
   }
   ```

3. **Sync:**
   ```bash
   npx cap sync
   ```

4. **Run in native app** - changes will reload automatically!

**Note:** Replace `YOUR_LOCAL_IP` with your computer's local IP address (e.g., `192.168.1.100`). Find it with:
- Mac/Linux: `ifconfig | grep "inet "`
- Windows: `ipconfig`

## üß™ Testing

### Testing on Emulator/Simulator

**Android:**
1. Open Android Studio
2. Start an emulator from AVD Manager
3. Run the app

**iOS:**
1. Open Xcode
2. Select a simulator from device list
3. Run the app

### Testing on Real Device

**Android:**
1. Enable **Developer Options** on your device
2. Enable **USB Debugging**
3. Connect via USB
4. Run from Android Studio

**iOS:**
1. Connect device via USB
2. Trust the computer on your device
3. Select device in Xcode
4. Run the app
5. Trust the developer certificate on device (Settings > General > VPN & Device Management)

## üêõ Troubleshooting

### Location Not Working

**Android:**
- Check that location permissions are granted in device settings
- Verify `ACCESS_FINE_LOCATION` permission in AndroidManifest.xml
- Test with `adb logcat` to see permission errors

**iOS:**
- Check Info.plist has location usage descriptions
- Verify permissions in device Settings > Privacy > Location Services
- Check Xcode console for permission errors

### Build Errors

**Android:**
```bash
# Clean and rebuild
cd android
./gradlew clean
cd ..
npx cap sync android
```

**iOS:**
```bash
# Clean build folder
cd ios/App
pod deintegrate
pod install
cd ../..
npx cap sync ios
```

### Plugin Not Working

1. Make sure plugin is installed: `npm list @capacitor/geolocation`
2. Sync Capacitor: `npx cap sync`
3. Rebuild native project
4. Check plugin is imported correctly in your code

## üì¶ What Changed

### New Files
- `src/utils/platform.ts` - Platform detection utilities
- `MOBILE_BUILD_GUIDE.md` - This guide

### Updated Files
- `src/hooks/useLocation.ts` - Now uses Capacitor Geolocation on native
- `capacitor.config.ts` - Enhanced with mobile-specific config
- `package.json` - Added Capacitor plugins

### New Dependencies
- `@capacitor/geolocation` - Native GPS tracking
- `@capacitor/camera` - Camera access
- `@capacitor/filesystem` - File system access
- `@capacitor/preferences` - Native storage
- `@capacitor/status-bar` - Status bar control
- `@capacitor/splash-screen` - Splash screen control

## üéØ Next Steps

1. **Test on real devices** - Make sure location tracking works
2. **Configure app icons** - Update icons in `android/app/src/main/res/` and `ios/App/App/Assets.xcassets/`
3. **Set up app signing** - Configure keystore for Android, certificates for iOS
4. **Test all features** - Verify all app features work on mobile
5. **Optimize performance** - Test and optimize for mobile devices
6. **Prepare for store** - Create store listings, screenshots, descriptions

## üìö Additional Resources

- [Capacitor Documentation](https://capacitorjs.com/docs)
- [Android Developer Guide](https://developer.android.com/)
- [iOS Developer Guide](https://developer.apple.com/ios/)
- [Capacitor Geolocation Plugin](https://capacitorjs.com/docs/apis/geolocation)
- [Capacitor Camera Plugin](https://capacitorjs.com/docs/apis/camera)

## ‚úÖ Checklist

Before publishing to stores:

- [ ] Test on real iOS device
- [ ] Test on real Android device
- [ ] Verify location permissions work
- [ ] Test all app features
- [ ] Update app icons and splash screens
- [ ] Configure app signing
- [ ] Test push notifications (if applicable)
- [ ] Review privacy policy for location data
- [ ] Prepare store listings
- [ ] Test app updates/upgrades

---

**Happy Building! üöÄ**

If you encounter any issues, check the troubleshooting section or refer to the Capacitor documentation.

